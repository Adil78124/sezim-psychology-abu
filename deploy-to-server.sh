#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –¥–µ–ø–ª–æ—è –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä

echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º –¥–µ–ø–ª–æ–π –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä..."

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
cd /path/to/sezim.abu.edu.kz

# –ü–æ–ª—É—á–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
echo "üì• –ü–æ–ª—É—á–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ GitHub..."
git pull origin main

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
echo "üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏..."
echo "üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Frontend –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏..."
cd frontend && npm install && cd ..
echo "üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Backend –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏..."
cd backend && npm install && cd ..

# –°–æ–±–∏—Ä–∞–µ–º —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
echo "üî® –°–æ–±–∏—Ä–∞–µ–º —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥..."
cd frontend && npm run build && cd ..

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º backend (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ PM2)
echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º backend..."
if command -v pm2 &> /dev/null; then
    pm2 restart psychology-backend || pm2 start ecosystem.config.js
else
    # –ï—Å–ª–∏ PM2 –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –∑–∞–ø—É—Å–∫–∞–µ–º —á–µ—Ä–µ–∑ systemd –∏–ª–∏ –¥—Ä—É–≥–æ–π –ø—Ä–æ—Ü–µ—Å—Å-–º–µ–Ω–µ–¥–∂–µ—Ä
    sudo systemctl restart psychology-backend || echo "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å"
fi

# –ö–æ–ø–∏—Ä—É–µ–º —Å–æ–±—Ä–∞–Ω–Ω—ã–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –≤ –≤–µ–±-–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
echo "üìÅ –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞..."
if [ -d "/var/www/html" ]; then
    sudo cp -r frontend/build/* /var/www/html/
elif [ -d "/home/$USER/public_html" ]; then
    cp -r frontend/build/* /home/$USER/public_html/
else
    echo "‚ö†Ô∏è –ù–µ –Ω–∞–π–¥–µ–Ω–∞ –≤–µ–±-–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã –∏–∑ –ø–∞–ø–∫–∏ frontend/build/ –≤—Ä—É—á–Ω—É—é."
fi

echo "‚úÖ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!"
echo "üåê Frontend: https://sezim.abu.edu.kz"
echo "üîß Backend: https://sezim.abu.edu.kz:5000"
